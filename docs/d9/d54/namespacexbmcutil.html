<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Kodi Docs: xbmcutil Namespace Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Thumbnail-symbol-whitebg-small.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Kodi Docs<span id="projectnumber">&#160;20.0</span>
   </div>
   <div id="projectbrief">Kodi is an open source media player and entertainment hub.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d9/d54/namespacexbmcutil.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle"><div class="title">xbmcutil Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="namespaces" name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:d8/dc3/namespacexbmcutil_1_1test"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/dc3/namespacexbmcutil_1_1test.html">test</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df5/classxbmcutil_1_1_globals_singleton.html">GlobalsSingleton</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/ded/classxbmcutil_1_1_init_flag.html">InitFlag</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >This file contains the pattern for moving "globals" from the BSS Segment to the heap. A note on usage of this pattern for globals replacement:</p>
<p >This pattern uses a singleton pattern and some compiler/C preprocessor sugar to allow "global" variables to be lazy instantiated and initialized and moved from the BSS segment to the heap (that is, they are instantiated on the heap when they are first used rather than relying on the startup code to initialize the BSS segment). This eliminates the problem associated with global variable dependencies across compilation units.</p>
<p >Reference counting from the BSS segment is used to destruct these globals at the time the last compilation unit that knows about it is finalized by the post-main shutdown. The book keeping is done by smuggling a smart pointer into every file that references a particular "global class" through the use of a 'static' declaration of an instance of that smart pointer in the header file of the global class (did you ever think you'd see a file scope 'static' variable in a header file - on purpose?)</p>
<p >There are two different ways to use this pattern when replacing global variables. The selection of which one to use depends on whether or not there is a possibility that the code in the .cpp file for the global can be executed from a static method somewhere. This may take some explanation.</p>
<p >The (at least) two ways to do this:</p>
<p >1) You can use the reference object std::shared_ptr to access the global variable.</p>
<p >This would be the preferred means since it is (very slightly) more efficient than the alternative. To use this pattern you replace standard static references to the global with access through the reference. If you use the C preprocessor to do this for you can put the following code in the header file where the global's class is declared:</p>
<p >static std::shared_ptr&lt;GlobalVariableClass&gt; g_globalVariableRef(xbmcutil::GlobalsSingleton&lt;GlobalVariableClass&gt;::getInstance()); #define g_globalVariable (*(g_globalVariableRef.get()))</p>
<p >Note what this does. In every file that includes this header there will be a <em>static</em> instance of the std::shared_ptr&lt;GlobalVariableClass&gt; smart pointer. This effectively reference counts the singleton from every compilation unit (ie, object code file that results from a compilation of a .c/.cpp file) that references this global directly.</p>
<p >There is a problem with this, however. Keep in mind that the instance of the smart pointer (being in the BSS segment of the compilation unit) is ITSELF an object that depends on the BSS segment initialization in order to be initialized with an instance from the singleton. That means, depending on the code structure, it is possible to get into a circumstance where the above #define could be exercised PRIOR TO the setting of the value of the smart pointer.</p>
<p >Some reflection on this should lead you to the conclusion that the only way for this to happen is if access to this global can take place through a static/global method, directly or indirectly (ie, the static/global method can call another method that uses the reference), where that static is called from initialization code exercised prior to the start of 'main.'</p>
<p >Because of the "indirectly" in the above statement, this situation can be difficult to determine beforehand.</p>
<p >2) Alternatively, when you KNOW that the global variable can suffer from the above described problem, you can restrict all access to the variable to the singleton by changing the #define to:</p>
<p >#define g_globalVariable (*(xbmcutil::Singleton&lt;GlobalVariableClass&gt;::getInstance()))</p>
<p >A few things to note about this. First, this separates the reference counting aspect from the access aspect of this solution. The smart pointers are no longer used for access, only for reference counting. Secondly, all access is through the singleton directly so there is no reliance on the state of the BSS segment for the code to operate correctly.</p>
<p >This solution is required for g_Windowing because it's accessed (both directly and indirectly) from the static methods of <a class="el" href="../../d7/ddf/class_c_log.html">CLog</a> which are called repeatedly from code exercised during the initialization of the BSS segment. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d9/d54/namespacexbmcutil.html">xbmcutil</a></li>
    <li class="footer">Generated on Sun Dec 26 2021 18:19:16 for Kodi Docs by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
<script type="text/javascript">
  // script for doxygen 1.9.1
  $(function() {
    toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
    toggleButton.title = "Toggle Light/Dark Mode"
    $(document).ready(function(){
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
    $(window).resize(function(){
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
  })
</script>
</body>
</html>
